<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPS Text Reader Fix</title>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
    <style>
        body { font-family: sans-serif; text-align: center; background: #f0f2f5; padding: 20px; }
        .card { max-width: 500px; margin: auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        #preview { width: 100%; border-radius: 5px; margin-top: 10px; display: none; }
        .status { margin: 15px 0; font-weight: bold; color: #555; }
        button { background: #1a73e8; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; display: none; margin: 10px auto; }
    </style>
</head>
<body>

<div class="card">
    <h2>ðŸ“¸ GPS Map Scanner</h2>
    <p>Photo upload karein jisme Lat/Long likha ho</p>
    
    <input type="file" id="imageInput" accept="image/*">
    <img id="preview">
    
    <div id="status" class="status">Waiting for image...</div>
    <div id="coordsDisplay"></div>
    
    <button id="openMap">Google Maps mein dekhein</button>
</div>

<script>
    const imageInput = document.getElementById('imageInput');
    const preview = document.getElementById('preview');
    const status = document.getElementById('status');
    const coordsDisplay = document.getElementById('coordsDisplay');
    const openMap = document.getElementById('openMap');

    let lat = "", lon = "";

    imageInput.addEventListener('change', async (e) => {
        const file = e.target.files[0];
        if (!file) return;

        // Preview setup
        preview.src = URL.createObjectURL(file);
        preview.style.display = "block";
        
        status.innerText = "â³ Library load ho rahi hai...";
        coordsDisplay.innerText = "";
        openMap.style.display = "none";

        try {
            // OCR Process
            const worker = await Tesseract.createWorker({
                logger: m => {
                    if(m.status === 'recognizing text') {
                        status.innerText = `ðŸ” Scanning: ${Math.round(m.progress * 100)}%`;
                    }
                }
            });

            await worker.loadLanguage('eng');
            await worker.initialize('eng');
            
            const { data: { text } } = await worker.recognize(file);
            await worker.terminate();

            console.log("Raw Text:", text); // Browser console (F12) mein text dikhega

            // Latitude aur Longitude nikalne ke liye thoda behtar Regex
            // Ye 25.123456 aur 75.123456 jaise formats dhoondhega
            const matches = text.match(/(\d+\.\d{4,})/g);

            if (matches && matches.length >= 2) {
                lat = matches[0];
                lon = matches[1];
                status.innerText = "âœ… Coordinates mil gaye!";
                coordsDisplay.innerHTML = `<p>Lat: ${lat} <br> Long: ${lon}</p>`;
                openMap.style.display = "block";
            } else {
                status.innerText = "âŒ Text toh mila par coordinates nahi mile.";
                console.log("Found text but no coords:", text);
            }

        } catch (error) {
            console.error(error);
            status.innerText = "âš ï¸ Error: Image read nahi ho payi. Internet check karein.";
        }
    });

    openMap.onclick = () => {
        window.open(`https://www.google.com/maps?q=${lat},${lon}`, '_blank');
    };
</script>

</body>
</html>
